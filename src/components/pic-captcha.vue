<template>
  <div class="pic-captcha" @click="refresh">
    <div v-if="svg" class="svg" v-html="svg" />
    <img v-else-if="base64" class="base64" :src="base64" alt="" />

    <template v-else>
      <el-icon class="is-loading">
        <Loading />
      </el-icon>
    </template>
  </div>
</template>

<script lang="ts" setup>
import { Loading } from "@element-plus/icons-vue";

const emit = defineEmits(["update:modelValue", "change"]);


// base64
const base64 = ref("");

// svg
const svg = ref("");

const captcha = ()=>{
  return new Promise((resolve)=>{
    setTimeout(()=>{
      const data = {
            "code": 1000,
            "message": "success",
            "data": {
              "captchaId": "ec40cd00-8db9-11ee-9039-2f8a8a41428d",
              "data": "<svg xmlns='http://www.w3.org/2000/svg' width='150' height='45' viewBox='0,0,150,45'><path fill='#2c3142' d='M123.37 35.37L123.34 35.34L123.34 35.33Q123.72 36.41 124.25 38.42L124.30 38.47L124.15 38.32Q119.99 37.05 115.38 37.32L115.37 37.31L115.50 37.44Q110.86 37.63 106.86 39.61L106.91 39.65L106.88 39.62Q107.17 39.00 107.21 39.08L107.04 38.91L107.18 39.05Q110.92 35.10 114.84 30.68L114.86 30.70L114.83 30.67Q119.12 25.56 120.30 20.88L120.31 20.89L120.31 20.89Q120.74 19.11 119.47 17.93L119.59 18.06L119.55 18.01Q118.26 16.83 116.47 16.98L116.40 16.90L116.46 16.96Q116.08 16.89 115.74 16.89L115.86 17.01L115.89 17.04Q114.32 16.99 113.06 17.90L112.95 17.79L113.09 17.93Q111.69 19.20 111.92 21.87L111.99 21.94L111.87 21.82Q110.15 21.54 108.94 21.09L108.91 21.06L109.00 21.15Q108.73 19.66 108.65 18.22L108.66 18.22L108.61 18.18Q108.53 16.53 109.14 15.39L109.21 15.46L109.14 15.39Q110.90 13.99 114.25 13.99L114.43 14.17L116.20 14.19L116.10 14.09Q118.46 14.20 119.41 14.31L119.39 14.29L119.40 14.31Q123.63 14.61 123.90 17.05L123.89 17.05L123.97 17.12Q123.95 17.60 123.88 18.40L123.86 18.38L123.86 18.38Q123.86 19.07 123.71 19.76L123.66 19.71L123.67 19.72Q122.03 27.83 114.46 34.68L114.63 34.85L114.63 34.85Q115.94 34.60 117.31 34.60L117.35 34.64L117.31 34.60Q120.53 34.58 123.38 35.38ZM122.90 14.65L122.74 14.49L122.76 14.51Q121.30 14.00 119.59 13.92L119.44 13.78L116.16 13.73L116.07 13.64Q111.57 13.33 109.36 14.43L109.39 14.46L109.39 14.46Q108.38 15.89 108.38 17.94L108.45 18.02L108.46 18.02Q108.35 18.60 108.66 21.42L108.80 21.56L108.70 21.46Q109.21 21.67 110.39 21.97L110.37 21.95L110.34 22.95L110.52 23.13Q110.31 23.41 110.38 23.94L110.52 24.08L110.49 24.05Q111.73 24.14 114.20 24.37L114.14 24.32L114.23 24.40Q114.22 24.05 114.22 23.71L114.09 23.58L114.18 23.66Q114.10 21.76 115.32 20.41L115.36 20.45L115.32 20.41Q116.64 19.16 118.43 19.27L118.40 19.25L118.47 19.32Q119.10 19.22 119.86 19.38L119.94 19.45L119.84 19.36Q120.05 19.83 120.13 20.25L120.17 20.29L120.08 20.21Q120.11 20.61 120.03 20.95L120.15 21.07L120.00 20.92Q118.86 25.79 114.44 30.63L114.32 30.51L114.40 30.59Q112.33 32.89 106.88 38.94L106.77 38.83L106.74 38.80Q106.61 39.70 106.27 40.27L106.33 40.34L106.36 40.36Q107.79 39.32 109.31 38.78L109.44 38.91L109.33 38.81Q108.73 39.50 107.78 40.99L107.78 40.98L107.74 40.95Q107.69 41.35 107.57 41.69L107.46 41.58L107.49 41.61Q112.29 39.48 117.77 39.67L117.86 39.76L117.90 39.80Q123.60 39.97 128.17 42.33L128.10 42.27L127.01 40.04L127.19 40.22Q126.40 38.74 126.13 37.94L126.21 38.02L126.17 37.98Q125.54 37.65 124.32 37.23L124.20 37.11L124.15 37.06Q124.09 36.44 123.71 35.07L123.63 34.98L123.67 35.02Q121.59 34.58 119.31 34.39L119.20 34.28L119.30 34.38Q123.84 29.67 125.36 21.41L125.51 21.56L125.69 18.65L125.63 18.60Q125.56 16.81 124.34 16.12L124.33 16.12L124.31 16.13L124.21 16.03Q124.34 16.13 124.27 16.13L124.16 16.02L124.20 16.06Q123.85 15.10 122.74 14.49Z'/><path d='M4 18 C83 18,74 4,137 27' stroke='#2c3142' fill='none'/><path fill='#2c3142' d='M86.50 20.91L86.57 20.97L86.47 20.87Q83.33 20.93 81.51 19.87L81.48 19.84L81.55 19.91Q83.92 18.40 88.80 14.18L88.80 14.18L88.93 14.31Q89.55 14.02 90.85 13.41L90.78 13.34L90.80 13.36Q89.53 19.36 89.41 25.72L89.52 25.83L89.39 25.70Q89.41 32.19 90.47 38.28L90.34 38.14L90.48 38.28Q88.77 37.53 86.64 37.41L86.65 37.43L86.54 37.31Q86.47 33.21 86.47 29.14L86.52 29.18L86.52 29.19Q86.40 24.96 86.44 20.85ZM86.02 23.05L86.16 37.77L86.11 37.72Q87.34 37.74 88.29 37.93L88.32 37.95L88.20 37.83Q88.32 38.56 88.51 39.93L88.57 39.99L88.59 40.01Q91.41 40.51 93.84 42.75L93.77 42.67L93.93 42.84Q91.43 35.69 91.39 28.23L91.26 28.10L91.31 28.15Q91.34 20.80 93.17 13.56L93.08 13.47L92.98 13.38Q92.52 13.86 90.92 14.97L90.98 15.03L91.01 15.06Q91.21 14.30 91.51 12.78L91.43 12.70L91.41 12.68Q90.18 13.55 88.73 13.93L88.67 13.86L88.70 13.89Q84.90 17.44 80.60 19.73L80.50 19.63L80.52 19.64Q81.92 20.74 84.28 21.08L84.37 21.17L84.41 21.21Q83.71 21.69 82.42 22.76L82.47 22.82L82.43 22.78Q83.84 23.08 86.04 23.08L86.06 23.10Z'/><path fill='#2c3142' d='M56.23 26.63L56.23 26.63L56.24 26.64Q54.51 26.77 53.29 28.10L53.18 28.00L53.12 27.93Q51.95 29.32 51.80 31.22L51.87 31.29L51.92 31.34Q51.60 33.34 52.81 34.35L52.90 34.44L52.85 34.38Q54.00 35.32 56.13 35.25L56.16 35.28L56.15 35.27Q58.44 35.08 59.39 34.13L59.49 34.23L59.42 34.16Q60.43 32.69 60.31 30.87L60.44 30.99L60.42 30.97Q60.19 29.00 59.11 27.80L59.24 27.93L59.13 27.82Q58.09 26.66 56.26 26.66ZM56.22 17.22L56.33 17.32L56.25 17.25Q54.94 17.23 53.61 17.73L53.55 17.67L53.53 17.65Q52.24 18.45 52.47 20.32L52.35 20.20L52.34 20.19Q52.93 24.01 56.28 24.01L56.20 23.94L56.27 24.01Q57.82 24.18 58.81 23.04L58.85 23.08L58.85 23.08Q59.85 21.95 59.89 20.39L59.79 20.29L59.91 20.41Q59.99 18.67 59.27 18.06L59.19 17.98L59.30 18.09Q57.52 17.15 56.23 17.23ZM56.03 37.85L56.07 37.89L52.90 37.77L53.01 37.88Q51.44 37.83 50.11 36.96L50.06 36.91L50.08 36.93Q48.64 35.71 48.79 32.85L48.80 32.86L48.79 32.86Q49.32 26.08 52.94 25.09L52.85 25.00L52.92 25.07Q50.69 24.21 49.35 18.84L49.29 18.77L49.25 18.73Q48.94 17.36 49.01 16.56L49.02 16.57L48.96 16.50Q49.32 14.43 53.01 14.39L53.08 14.46L52.99 14.36Q57.18 14.26 58.63 14.45L58.67 14.49L58.77 14.59Q62.47 14.98 62.93 17.00L63.08 17.15L63.07 17.13Q63.06 17.62 63.06 18.01L63.05 17.99L63.07 18.01Q63.20 18.83 63.01 19.44L63.00 19.43L62.88 19.31Q62.36 23.62 59.43 25.14L59.36 25.07L59.50 25.21Q62.98 25.99 63.47 31.28L63.39 31.21L63.39 31.20Q63.37 31.33 63.41 32.63L63.47 32.69L63.48 32.70Q63.53 35.41 61.93 36.48L61.94 36.49L61.97 36.52Q60.46 37.25 55.89 37.71ZM58.20 40.06L58.33 40.19L61.56 40.14L61.59 40.17Q63.36 40.31 64.88 39.58L64.93 39.63L64.81 39.52Q66.08 38.92 66.16 37.05L66.12 37.01L66.00 36.90Q66.12 35.88 65.74 33.93L65.70 33.89L65.72 33.92Q64.90 29.36 62.80 27.49L62.71 27.40L62.63 27.13L62.32 26.75L62.19 26.50L62.24 26.55Q63.76 25.06 64.67 20.91L64.75 20.99L64.79 21.03Q64.76 20.61 64.83 19.78L64.75 19.70L64.80 19.74Q64.94 19.13 64.87 18.52L64.82 18.47L64.79 18.44Q64.63 16.98 63.45 16.49L63.52 16.56L63.45 16.45L63.24 16.32L63.30 16.37Q63.06 15.68 61.88 14.88L61.91 14.91L62.01 14.97L61.88 14.85Q60.04 14.29 55.96 14.10L55.89 14.03L55.93 14.07Q54.29 13.88 52.92 14.00L52.93 14.01L52.91 13.98Q52.19 14.10 50.90 14.26L50.82 14.18L50.74 14.10Q48.89 14.57 48.67 16.21L48.68 16.22L48.61 16.15Q48.54 16.62 48.58 17.42L48.76 17.60L48.64 17.48Q48.76 18.02 49.34 20.38L49.31 20.36L49.33 20.38Q50.10 23.58 51.85 24.91L51.88 24.95L51.91 24.98L51.93 24.99Q49.23 26.37 48.70 31.55L48.58 31.43L48.70 31.55Q48.49 33.74 48.49 34.65L48.42 34.58L48.42 34.58Q48.60 36.47 49.78 37.38L49.69 37.29L49.74 37.35Q49.95 37.52 50.22 37.71L50.04 37.53L50.16 37.65Q51.15 39.90 58.27 40.13ZM57.95 29.07L57.88 29.00L57.88 29.01Q58.79 28.93 59.67 29.38L59.63 29.35L59.68 29.39Q60.00 30.33 59.97 30.86L59.99 30.89L60.05 30.95Q60.17 31.33 60.17 31.63L60.19 31.65L60.15 31.62Q60.16 33.99 57.88 34.82L57.80 34.75L57.81 34.76Q57.05 35.10 56.25 34.99L56.13 34.87L56.12 34.86Q55.03 34.99 53.89 34.53L54.01 34.65L53.99 34.63Q53.68 33.94 53.76 32.95L53.76 32.96L53.79 32.99Q53.92 31.37 55.12 30.15L55.18 30.21L55.08 30.11Q56.42 29.03 58.02 29.15ZM58.15 19.56L58.15 19.56L58.06 19.47Q58.92 19.42 59.45 19.57L59.51 19.63L59.50 20.42L59.47 20.39Q59.46 21.79 58.55 22.80L58.66 22.92L58.48 22.74Q57.75 23.92 56.37 23.73L56.37 23.73L56.38 23.73Q55.35 23.69 54.93 23.46L54.95 23.48L54.83 23.37Q54.77 23.07 54.65 22.39L54.76 22.49L54.74 22.48Q54.49 21.09 55.71 20.25L55.75 20.29L55.62 20.16Q56.74 19.53 58.15 19.57Z'/><path fill='#2c3142' d='M23.94 37.78L24.11 37.95L24.13 37.96Q19.99 38.13 19.00 35.80L19.07 35.88L18.93 35.74Q19.78 34.88 21.34 33.09L21.28 33.02L21.20 32.95Q21.79 35.06 24.80 35.17L24.88 35.26L24.81 35.18Q28.19 35.25 29.83 33.92L29.84 33.94L29.83 33.92Q31.24 32.32 31.16 29.62L31.14 29.60L31.20 29.66Q31.01 24.56 26.22 24.79L26.16 24.73L26.29 24.86Q23.46 25.00 21.70 26.25L21.61 26.16L21.38 26.08L21.12 25.90L21.20 25.98Q21.52 22.80 21.41 20.06L21.31 19.96L21.42 20.07Q21.31 17.44 20.97 14.13L20.93 14.10L20.98 14.14Q24.47 14.94 28.28 14.82L28.29 14.84L28.42 14.96Q32.21 14.87 35.79 13.61L35.72 13.55L35.23 15.15L35.18 15.10Q34.81 15.79 34.61 16.63L34.73 16.74L34.62 16.63Q31.46 17.62 27.58 17.62L27.66 17.70L27.60 17.65Q26.22 17.71 24.74 17.56L24.72 17.54L24.73 17.55Q24.65 18.23 24.30 22.69L24.23 22.62L24.30 22.68Q25.13 22.21 27.18 22.06L27.15 22.03L27.28 22.16Q30.94 22.31 32.38 23.99L32.32 23.93L32.46 24.07Q33.75 25.51 34.01 29.35L33.98 29.32L34.01 29.35Q34.22 33.48 33.00 35.50L32.97 35.46L33.14 35.64Q31.08 37.50 27.77 37.73L27.70 37.65L27.72 37.67Q26.79 37.81 24.13 37.97ZM30.12 40.19L30.15 40.22L30.07 40.14Q33.52 40.24 35.43 39.14L35.39 39.10L35.37 39.09Q36.41 37.61 36.41 35.52L36.49 35.60L36.43 35.53Q36.39 32.41 35.44 28.30L35.51 28.38L35.45 28.31Q35.02 26.51 33.80 25.11L33.80 25.10L33.90 25.24L33.59 24.86L33.40 24.82L33.42 24.83Q33.08 24.07 32.43 23.39L32.34 23.30L32.34 23.33L32.34 23.34Q30.93 21.77 27.23 21.77L27.20 21.74L26.92 21.72L26.94 21.74Q26.97 21.13 27.16 20.02L27.11 19.98L27.19 20.05Q32.09 20.08 36.12 18.44L36.10 18.42L36.12 18.44Q36.52 17.01 37.47 14.19L37.55 14.27L35.48 15.25L35.39 15.16Q35.84 14.08 36.34 12.94L36.31 12.92L36.27 12.87Q32.52 14.42 28.41 14.49L28.42 14.51L28.33 14.42Q24.29 14.60 20.33 13.50L20.34 13.51L20.24 13.40Q20.96 17.86 20.96 22.28L21.09 22.40L20.99 22.31Q20.97 24.19 20.86 26.09L20.91 26.15L20.81 26.05Q21.12 26.28 21.69 26.58L21.71 26.60L21.75 26.64Q22.16 26.48 22.81 26.14L22.67 26.00L22.64 25.97Q22.73 26.86 22.50 28.38L22.53 28.41L22.43 28.32Q22.89 28.54 23.31 28.77L23.33 28.79L23.29 28.75Q26.14 27.07 28.00 27.07L27.96 27.03L27.98 27.05Q29.36 27.09 30.54 27.74L30.41 27.61L30.54 27.74Q30.84 28.73 30.88 29.68L30.84 29.64L30.74 29.54Q30.96 32.27 29.93 33.37L29.89 33.33L29.88 33.32Q28.45 34.48 26.20 34.71L26.35 34.86L26.24 34.75Q25.37 34.91 24.69 34.83L24.70 34.84L24.61 34.76Q23.77 34.64 23.01 34.30L23.02 34.31L23.00 34.09L22.90 34.23L22.84 34.17Q22.11 33.74 21.58 32.41L21.53 32.36L21.62 32.45Q20.17 33.74 18.49 35.87L18.62 36.00L18.55 35.92Q18.92 36.64 19.76 37.60L19.75 37.58L19.63 37.46Q20.79 39.39 23.61 39.88L23.64 39.91L23.61 39.89Q24.63 39.96 30.00 40.07Z'/></svg>"
            }
      }
      resolve(data)
    },500)
  })
}


async function refresh() {

  await captcha().then((res) => {
        const { captchaId, data } = res.data
        if (data.includes(";base64,")) {
          base64.value = data;
        } else {
          svg.value = data;
        }

        emit("update:modelValue", captchaId);
        emit("change", {
          base64,
          svg,
          captchaId
        });
      })
      .catch((err) => {
        ElMessage.error(err.message);
      });
}

onMounted(() => {
  refresh();
});

defineExpose({
  refresh
});
</script>

<style lang="scss" scoped>
.pic-captcha {
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  height: 45px;
  width: 150px;
  position: relative;

  .svg {
    height: 100%;
    position: relative;
  }

  .base64 {
    height: 100%;
  }

  .el-icon {
    position: absolute;
    font-size: 22px;
    right: 20px;
  }
}
</style>
